const debug=!1,uid=crypto.getRandomValues(new Uint16Array(3)).join("-");let isDetected=!1;const globalHook={reportDetection(e={}){this.executeInContext(function(){__PIXI_INSPECTOR_GLOBAL_HOOK__.reportDetection(window,RECIPIENT)}.toString(),{RECIPIENT:e})},reportInstances(e){this.executeInContext(function(){__PIXI_INSPECTOR_GLOBAL_HOOK__.reportInstances(RECIPIENT)}.toString(),{RECIPIENT:e})},reportInspector(e,t){this.executeInContext(function(){__PIXI_INSPECTOR_GLOBAL_HOOK__.reportInspector(INDEX,RECIPIENT)}.toString(),{INDEX:e,RECIPIENT:t})},disable(){this.executeInContext(function(){__PIXI_INSPECTOR_GLOBAL_HOOK__.disable()}.toString())},executeInContext(e,t={}){for(const o in t){const n=JSON.stringify(t[o]);e=e.replace(new RegExp(o,"g"),n)}const o=document.createElement("script");o.textContent=";("+e+")(window)",document.documentElement.appendChild(o),o.parentNode.removeChild(o)}};!function(){const e=function(e){const t=UID,o=DEBUG;function n(n,s,r){o&&console.log("respond",{response:n,data:s,recipient:r}),e.postMessage(Object.assign({response:n,data:s,_pixiInspector:t},r),"*")}let s=-1;function r(n,r){o&&console.log("emit",{command:n,data:r}),e.postMessage({command:n,to:s,data:r,_pixiInspector:t},"*")}const i=[];let c=!1;e.__PIXI_INSPECTOR_GLOBAL_HOOK__={inspectors:[],register(n){const s=i.find((e=>e.PIXI===n.PIXI));if(s)return void(n.Phaser&&(s.Phaser=n.Phaser));var r,c,a;r="DETECTED",c={channel:"devtools_page"},a={index:i.push(Object.assign({status:"IDLE"},n))-1,version:n.PIXI.VERSION,phaser:!!n.Phaser&&n.Phaser.VERSION},o&&console.log("broadcast",{command:r,recipient:c,data:a}),e.postMessage({broadcast:r,filter:c,data:a,_pixiInspector:t},"*")},reportInstances(t){this.reportDetection(e,t),n("INSTANCES",i.map((e=>({version:e.PIXI.VERSION,status:e.status}))),t)},reportDetection(e,t){if(e.Phaser&&e.Phaser.PIXI)this.register({PIXI:e.Phaser.PIXI,Phaser:e.Phaser},t);else if(e.game&&e.game.PIXI)this.register({PIXI:e.game.PIXI},t);else if(e.PIXI)this.register({PIXI:e.PIXI},t);else for(let n=0;n<e.frames.length;n++)try{this.reportDetection(e.frames[n],t)}catch(e){if(18===e.code&&"SecurityError"===e.name)return;o&&console.warn(e)}},reportInspector(e,t){i[e]?(s=t.to,"IDLE"===i[e].status?(i[e].status="LOADING",this.injectInspector().then((o=>{this.inspectors.push(new o(i[e],r)),i[e].inspector=this.inspectors.length-1,i[e].status="INJECTED",n("INSPECTOR",i[e].inspector,t)})).catch((e=>{n("ERROR",e.message,t)}))):n("INSPECTOR",i[e].inspector,t)):n("ERROR","OUT_OF_BOUNDS",t)},injectInspector(){return c||(c=new Promise((t=>{const o=e.document.createElement("script");o.src=INSPECTOR_SCRIPT_URL;const n=document.getElementsByTagName("html")[0];o.onload=()=>{t(this.Inspector)},n.appendChild(o)})),c)},disable(){for(const e of this.inspectors)e.disable()}}}.toString();globalHook.executeInContext(e,{UID:uid,DEBUG:!1,INSPECTOR_SCRIPT_URL:chrome.extension.getURL("pixi.inspector.bundle.js")})}();const port=chrome.runtime.connect({name:"content_scripts"});port.onMessage.addListener((e=>{switch(e.command){case"DETECT":globalHook.reportDetection({to:e.from,id:e.id});break;case"INSTANCES":globalHook.reportInstances({to:e.from,id:e.id});break;case"INSPECTOR":globalHook.reportInspector(e.data,{to:e.from,id:e.id});break;case"DISCONNECTED":globalHook.disable()}})),window.onmessage=function(e){"object"==typeof e.data&&e.data._pixiInspector===uid&&(delete e.data._pixiInspector,port.postMessage(e.data),"DETECTED"===e.data.response&&(isDetected=!0))},port.onDisconnect.addListener((()=>{window.onmessage=null})),window.onload=function(){globalHook.reportDetection(),setTimeout((()=>{isDetected||globalHook.reportDetection()}),1e3)};